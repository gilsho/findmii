function A = faceAffinityMatrix(faces,dim)
%UNTITLED returns an affinity matrix with the euclidean distance between
%each pair of faces in an image
%   faces is a cell array containing the faces to compare
%  dim is the dimension to compare images by

if (nargin < 2)
    dim = 40;
end

numFaces = numel(faces);
F = zeros(numFaces,3*dim^2);
A = zeros(numFaces);



for i=1:numFaces
    %convert to square
    face = faces{i}
    [rows,cols] =  size(face);
    if (rows > cols)
       diff = rows - cols;
       ylow = round(diff/2);
       yhigh = 
       face = face(round(diff/2):end-(diff-round(diff/2)),:);
    elseif (cols < rows)
        
    end
    ln = min(size(face(:,:,1))); %restrict to squares. could also try max
    ratio = ln/dim;
    fbox = zeros(dim,dim,3);
    for i=1:3
        fbox(:,:,i) = resample_bilinear(face(:,:,i),ratio);
    end
    F(i,:) = fbox(:)';
end

for i=1:numFaces
    for j=1:numFaces
        if (i==j)
            A(i,j) = inf;
        else
            A(i,j) = norm(F(i,:) - F(j,:));
        end
    end
end

